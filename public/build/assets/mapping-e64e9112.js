const d=document.querySelector("#map"),u=document.querySelector("#create_map"),m=document.querySelector("#view_map");function r({map_id:o,dragging:n=!1}){var t=L.map(o,{center:[14.493569,120.904096],zoom:18,maxZoom:20,minZoom:17,scrollWheelZoom:"center",zoomControl:!1,dragging:n});return L.tileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:20,subdomains:["mt0","mt1","mt2","mt3"]}).addTo(t),L.polygon([[14.493824,120.902181],[14.49319,120.902519],[14.493392,120.902959],[14.492084,120.903752],[14.491824,120.904187],[14.493834,120.905694],[14.494888,120.904911]]).addTo(t),t}d&&r({map_id:"map"});if(u){let i=function(e){a.setLatLng(e.latlng).setContent(`<div class="flex gap-2"> <p>Longitude: ${e.latlng.lng.toPrecision(8)}</p> <p>Latitude: ${e.latlng.lat.toPrecision(8)}</p> </div>`).openOn(c),document.querySelector("#longitude").value=e.latlng.lng.toPrecision(8),document.querySelector("#latitude").value=e.latlng.lat.toPrecision(8)};var onMapClick=i;const o=document.querySelector("#map_modal");let n=null,t=null;document.querySelectorAll(".mapping_btn").forEach(e=>{e.addEventListener("click",()=>{n=e.dataset.resident,t=e.dataset.mapping,o.classList.toggle("invisible"),o.classList.toggle("flex")})});const c=r({map_id:"create_map",dragging:!0}),a=L.popup();c.on("click",i),document.querySelector("#set_mapping").addEventListener("click",()=>{if(document.querySelector("#longitude").value==""||document.querySelector("#latitude").value=="")return document.querySelector("#error-msg").innerText="You must select a location",!1;t==""?fetch(BASE_PATH+"/mapping/new",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').content},credentials:"same-origin",body:JSON.stringify({residentId:n,longitude:document.querySelector("#longitude").value,latitude:document.querySelector("#latitude").value})}).then(e=>e.json()).then(e=>{location.reload()}):fetch(BASE_PATH+"/mapping/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').content},credentials:"same-origin",body:JSON.stringify({residentId:n,mappingId:t,longitude:document.querySelector("#longitude").value,latitude:document.querySelector("#latitude").value})}).then(e=>e.json()).then(e=>{location.reload()})})}let l;if(m){const o=document.querySelector("#map_modal"),n=14.494045,t=120.904006;document.querySelectorAll(".mapping_btn").forEach(a=>{a.addEventListener("click",()=>{a.dataset.resident,a.dataset.mapping;const i=a.dataset.longitude,e=a.dataset.latitude;document.querySelector("#longitude").value=i,document.querySelector("#latitude").value=e,o.classList.toggle("invisible"),o.classList.toggle("flex"),l!=null&&(l.spliceWaypoints(0,2),l.remove()),L.marker([e,i]).addTo(c),l=L.Routing.control({waypoints:[L.latLng(n,t),L.latLng(e,i)]}).addTo(c)})});const c=r({map_id:"view_map",dragging:!0})}document.querySelector("#close_map")&&(l&&(l.spliceWaypoints(0,2),l.remove()),document.querySelector("#close_map").addEventListener("click",()=>{document.querySelector("#map_modal").classList.toggle("invisible")}));
